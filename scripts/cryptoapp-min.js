let cryptoDataContainer=document.getElementById("crypto-data");const searchInput=document.getElementById("search"),modal=document.getElementById("price-alert-modal"),closeButton=document.querySelector(".close-button"),setAlertButton=document.getElementById("set-alert-button");let currentCoinId=null;const toggleThemeButton=document.getElementById("toggle-theme"),loadingSpinner=document.getElementById("loading-spinner"),errorMessage=document.createElement("div");errorMessage.className="error-message",cryptoDataContainer.appendChild(errorMessage);let darkMode=JSON.parse(localStorage.getItem("darkMode"))||!1;const favorites=JSON.parse(localStorage.getItem("favorites"))||[];function debounce(e,t){let a;return function(...r){clearTimeout(a),a=setTimeout((()=>e.apply(this,r)),t)}}async function fetchCryptoPrices(){loadingSpinner.style.display="block",errorMessage.textContent="",cryptoDataContainer.innerHTML="";try{const e=await fetch("https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=20&page=1&sparkline=false");if(!e.ok)throw new Error("Failed to fetch data from the server.");populateCryptoData(await e.json())}catch(e){errorMessage.textContent="Error loading data. Please try again later."}finally{loadingSpinner.style.display="none"}}function populateCryptoData(e){cryptoDataContainer.innerHTML="";[...e.filter((e=>favorites.includes(e.id))),...e.filter((e=>!favorites.includes(e.id)))].forEach((e=>{const t=document.createElement("div");t.className="crypto-card",t.dataset.id=e.id,t.innerHTML=`\n            <h2>${e.name} (${e.symbol.toUpperCase()})</h2>\n            <p>Price: ${e.current_price.toFixed(2)} USD</p>\n            <p>Change: ${e.price_change_percentage_24h.toFixed(2)}%</p>\n            <p>Market Cap: ${e.market_cap.toLocaleString()} USD</p>\n            <button class="favorite-button" data-tooltip="${favorites.includes(e.id)?"Remove":"Add"} ${e.name} ${favorites.includes(e.id)?"from":"to"} your favorites">${favorites.includes(e.id)?"Remove from Favorites":"Add to Favorites"}</button>\n            <button class="alert-button" data-tooltip="Set a price alert for ${e.name}">Set Price Alert</button>\n        `,cryptoDataContainer.appendChild(t),t.querySelector(".favorite-button").addEventListener("click",(()=>{toggleFavorite(e.id)})),t.querySelector(".alert-button").addEventListener("click",(()=>{setPriceAlert(e.id)}))})),updateFavoritesDisplay()}function toggleFavorite(e){favorites.includes(e)?favorites.splice(favorites.indexOf(e),1):favorites.push(e),localStorage.setItem("favorites",JSON.stringify(favorites)),fetchCryptoPrices()}function updateFavoritesDisplay(){const e=cryptoDataContainer.getElementsByClassName("crypto-card");for(let t of e){const e=t.dataset.id;favorites.includes(e)?(t.classList.add("favorite"),t.querySelector(".favorite-button").classList.add("favorite")):(t.classList.remove("favorite"),t.querySelector(".favorite-button").classList.remove("favorite"))}}const debouncedSearch=debounce((()=>{const e=searchInput.value.toLowerCase(),t=cryptoDataContainer.getElementsByClassName("crypto-card");for(let a of t){const t=a.querySelector("h2").textContent.toLowerCase();a.style.display=t.includes(e)?"":"none"}}),300);function setPriceAlert(e){currentCoinId=e,modal.style.display="block"}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function checkPriceAlerts(){const e=JSON.parse(localStorage.getItem("priceAlerts"))||{},t=cryptoDataContainer.getElementsByClassName("crypto-card");for(let a of t){const t=a.dataset.id,r=parseFloat(a.querySelector("p").textContent.match(/[\d.]+/)[0]);if(e[t]){r>=e[t]&&(alert(`Price alert! ${capitalizeFirstLetter(t)} has reached ${r} USD.`),delete e[t])}}localStorage.setItem("priceAlerts",JSON.stringify(e))}document.body.classList.toggle("dark-mode",darkMode),toggleThemeButton.innerHTML='<i class="fas fa-adjust"></i> '+(darkMode?"Dark Theme":"Light Theme"),searchInput.addEventListener("input",debouncedSearch),toggleThemeButton.addEventListener("click",(()=>{darkMode=!darkMode,document.body.classList.toggle("dark-mode",darkMode),localStorage.setItem("darkMode",JSON.stringify(darkMode)),toggleThemeButton.innerHTML='<i class="fas fa-adjust"></i> '+(darkMode?"Dark Theme":"Light Theme")})),closeButton.addEventListener("click",(()=>{modal.style.display="none"})),setAlertButton.addEventListener("click",(()=>{const e=parseFloat(document.getElementById("alert-price").value);if(isNaN(e))alert("Please enter a valid price.");else{const t=JSON.parse(localStorage.getItem("priceAlerts"))||{};t[currentCoinId]=e,localStorage.setItem("priceAlerts",JSON.stringify(t)),alert(`Price alert set for ${capitalizeFirstLetter(currentCoinId)} at ${e} USD.`),modal.style.display="none"}}));const newsSectionContainer=document.createElement("div");newsSectionContainer.id="news-section";const newsHeading=document.createElement("h2");newsHeading.textContent="Latest Cryptocurrency News";const articlesContainer=document.createElement("div");async function fetchCryptoNews(){try{const e=await fetch("https://cointelegraph.com/rss");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.text(),a=new DOMParser,r=a.parseFromString(t,"text/xml").getElementsByTagName("item");displayNewsArticles(Array.from(r).slice(0,30).map((e=>({title:e.getElementsByTagName("title")[0].textContent,description:e.getElementsByTagName("description")[0].textContent,url:e.getElementsByTagName("link")[0].textContent,publishedAt:e.getElementsByTagName("pubDate")[0].textContent}))))}catch(e){newsSectionContainer.innerHTML="<p>Error loading news. Please try again later.</p>"}}function displayNewsArticles(e){const t=document.getElementById("news-articles");t.innerHTML="",e.forEach((e=>{const a=document.createElement("div");a.className="news-article",a.innerHTML=`\n      <h3><a href="${e.url}" target="_blank">${e.title}</a></h3>\n      <p>${e.description}</p>\n      <p><small>Published on: ${new Date(e.publishedAt).toLocaleDateString()}</small></p>\n    `,t.appendChild(a)}))}articlesContainer.id="news-articles",newsSectionContainer.appendChild(newsHeading),newsSectionContainer.appendChild(articlesContainer),document.body.appendChild(newsSectionContainer),document.addEventListener("DOMContentLoaded",(()=>{fetchCryptoPrices().then((()=>{fetchCryptoNews()})).catch((e=>{})),setInterval((()=>{fetchCryptoPrices().then((()=>{fetchCryptoNews()})).catch((e=>{}))}),6e4),setInterval(checkPriceAlerts,6e4)}));
